<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>3_react生命周期(新)</title>
    <script src="../17.0.1/react.development-v17.0.1.js"></script>
    <script src="../17.0.1/react-dom.development-v17.0.1.js"></script>

    <!-- Don't use this in production: -->
		<script src="../6.15.babel.min.js"></script>
		<script src="../15.6.0.prop-types.js"></script>
 
  </head>
  <body>
		<div id="test"></div>
		<div id="test2"></div>
		<script type="text/babel">
			//新版的react，17以上的依赖也可以用旧的生命周期函数，不过不推荐，浏览器会有警告
			//componentWillReceiveProps,componentWillUpdate,componentWillMount 在新版本里，前面要加UNSAFE_
			//例如 UNSAFE_componentWillMount

			//新生命周期与旧生命周期的主要差别：
			// 废弃了三个旧的生命周期：componentWillReceiveProps,componentWillUpdate,componentWillMount
			// 新增了两个新的生命周期：getDerivedStateFromProps.getSnapshotBeforeUpdate

			//生命周期回调函数 == 生命周期钩子函数 == 生命周期函数 == 生命周期钩子

				/*
				1.初始化阶段： 由ReactDOM.render() 触发---初始渲染
				        1. constructor()
								2. getDerivedStateFromProps()
								3. render()
								4. componentDidMount() ========> 常用
								一般再这个钩子中做一些初始化的事，例如：开启定时器、发送网络请求、订阅消息
				2.更新阶段： 由组件内部this.setState() 或父组件render触发
								1. getDerivedStateFromProps
					      2. shouldComponentUpdate()
								3. render() ========> 必须使用的一个
								4. getSnapshotBeforeUpdate()
								5. componentDidUpdate()
				3. 卸载组件： 由ReactDOM.unmountComponentAtNode()触发
								1. componentWillUnmount() ========> 常用
								一般在这个钩子中做一些收尾的事，例如：关闭定时器、取消订阅消息
			*/


			class Count extends React.Component{


				//构造器
				constructor(props) {
					console.log('Count---constructor')
					super(props)
					// 初始化状态
					this.state = {count:0}
				}

				//加1按钮的回调
				add = ()=>{
					// 获取原状态
					const {count} = this.state
					// 更新状态
					this.setState({count:count+1})
				}

				//卸载组件
				death = ()=>{
					ReactDOM.unmountComponentAtNode(document.getElementById('test'))
				}

				//强制更新按钮的回调
				force = ()=>{
					this.forceUpdate()
				}

				// getDerivedStateFromProps必须返回 1.null 或者2.状态对象{}
				// 这个钩子极度少用  作用就是强制让state在任何时候都取决于 props
				static getDerivedStateFromProps(props,state) {
					console.log('getDerivedStateFromProps',props,state)
					//return props //这样写对状态count有影响，无法用+1来修改
					return null
				}

				//组件将要挂载的钩子
				// UNSAFE_componentWillMount() {
				// 	console.log('Count---componentWillMount')
				// }



				// 在更新之前获取快照
				getSnapshotBeforeUpdate(){
					console.log('getSnapshotBeforeUpdate')
					return 'caonima'
				}


				//组件挂载完毕的钩子
				componentDidMount() {
					console.log('Count---componentDidMount')
				}

				//组件将要卸载得钩子
				componentWillUnmount(){
					console.log('Count---componentWillMount')
				}

				//控制组件更新的阀门
				shouldComponentUpdate() {
					console.log('Count---shouldComponentUpdate')
					// 必须写一个返回值 只能是Boolean  不写shouldComponentUpdate的话就默认为true
					return true
				}

				//组件将要更新完的钩子
				// UNSAFE_componentWillUpdate(){
				// 	console.log('Count---componentWillUpdate')
				// }

				//组件更新完毕的钩子
				componentDidUpdate(preProps,preState,snapshotValue){
					console.log('Count---componentDidUpdate',preProps,preState,snapshotValue)
				}

				//初始化渲染，状态更新之后
				render() {
					console.log('render')
					const {count} = this.state
					return(
						<div>
							<h2>当前求和为：{count}</h2>
							<button onClick={this.add}>点我+1</button>
							<button onClick={this.death}>卸载组件</button>
							<button onClick={this.force}>不更改任何状态中的数据，强制更新一下</button>
						</div>
					)
				}
			}
			// 渲染组件
			ReactDOM.render(<Count count="199"/>,document.getElementById('test'))

			//创建组件
			class A extends React.Component{
				// 初始化状态
				state = {carName:'奔驰'}

				changeCar = ()=>{
					this.setState({carName:'奥托'})
				}

				render(){
					return(
						<div>
							<div>我是A组件</div>
							<button onClick={this.changeCar}>换车</button>
							<B carName={this.state.carName}/>
						</div>
					)
				}
			}

			class B extends React.Component{
				//组件将要接收新的props的钩子
				// UNSAFE_componentWillReceiveProps(props){
				// 	console.log('B---componentWillReceiveProps',props)
				// }

				render(){
					return (
						<div>我是B组件，接受到的车是：{this.props.carName}</div>
					)
				}
			}
			// 渲染组件
			ReactDOM.render(<A/>,document.getElementById('test2'))
		</script>
  </body>
</html>